---
applyTo: '**/*.py'
---

# Python プロジェクト コーディング標準

## 一般的なガイドライン

* すべてのPythonコードは、PEP 8 スタイルガイドライン(https://pep8-ja.readthedocs.io/ja/latest/)に準拠する必要があります。
* 常に最新のPythonのプラクティスと構文（型アノテーションやジェネリクスなど）を使用してください。
* コードの可読性、保守性、効率性を優先してください。
* 必要に応じて、組み込み関数と標準ライブラリのモジュールをサードパーティのパッケージよりも優先してください。
* DRY (Don't Repeat Yourself) 原則を守ってください。
* 不必要な抽象化を避け、物事をシンプルで読みやすく保ってください。

## コード構成

* コードは論理的なモジュールとパッケージに整理してください。
* 関連する機能をパッケージにグループ化し、パッケージを集中させ、まとまりのあるものにしてください。
* 意味のあるパッケージ名を使用し、`utils`や`common`のような一般的な名前は避けてください。
* ファイルの先頭で、標準ライブラリ、サードパーティ、ローカルインポートの順にインポートをグループ化してください。
* 複雑なクラスは1ファイル1クラスとすることを推奨し、関連するユーティリティはグループ化しても構いません。

## 命名

* **変数・関数:** 小文字＋アンダースコア（`snake_case`）を使用してください。スコープの小さい変数には短い名前を使用し、宣言から離れて長く使用される変数にはより長い名前を使用してください。
* **クラス:** キャメルケース（先頭大文字、`PascalCase`）を使用してください。
* **定数:** 大文字＋アンダースコア（`SCREAMING_SNAKE_CASE`）を使用してください。
* **プライベートメソッド・変数:** 先頭にアンダースコア (`_internal_method`) を使用してください。
* **「プライベート」クラスメンバー (名前マングリング):** 必要な場合のみ先頭にダブルアンダースコア (`__private_attr`) を使用してください。
* 説明的な名前を使用し、略語は避けてください。
* 予約語や単一文字（`l`、`O`、`I`など）を変数名や関数名に使用しないでください。

## エラー処理

* 空の `except` 句を使用せず、常に具体的な例外タイプを明示的に指定してください。
* リソース管理にはコンテキストマネージャ (`with` 文) を使用してください。
* ビジネスロジックエラーをラップして処理するために、カスタムエラー型を使用してください。
* モデル入力の適切なエラーチェックを実装し、構成パラメータを検証してください。
* すべての非同期関数でエラー処理を含めてください。
* 内部エラーをクライアントに公開せず、ログに記録し、一般的なメッセージを返してください。

## ロギング

* デバッグには `print` 文ではなく、適切なロギングを実装してください。
* ログの記録にはプロジェクトで定義されたロギングユーティリティを使用してください。
* 特に要求がない限り、ロギングを追加・提案しないでください。
* 既存のログ文は、直接修正対象でない限り変更しないでください。

## テスト

* すべての新しいパッケージと、ほとんどの新しい重要な機能には、単体テストを付属させる必要があります。
* TDD（テスト駆動開発）を実践してください。テストケースが失敗することを確認してから、テストをパスさせるコードを書いてください。
* テスト実行には `pytest` を推奨します。
* テーブル駆動テストは複数のシナリオ/入力をテストするのに推奨されます。
* テストは `tests` ディレクトリに配置してください。テストファイル名とテスト関数名は明確にしてください。
* テスト関数では `arrange`, `act`, `assert` パターンを使用してください。
* 成功と失敗の両方のシナリオをテストし、エラー処理やエッジケースも検証してください。
* 複雑なテストで絶対に必要な場合を除き、パラメータ化テストや期待される例外デコレーターのようなpytestフィクスチャは使用しないでください。
* アサーションにはドキュメントを追加しないでください。
* 適切な単体テストカバレッジが必要です。